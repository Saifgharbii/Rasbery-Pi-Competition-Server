<script>
  // Timer Logic
  let timeLeft = Math.floor(durationInMinutes * 60); // Convert to seconds

  const timerElement = document.getElementById("timer");

  function updateTimer() {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    timerElement.textContent = `${String(minutes).padStart(2, "0")}:${String(
      seconds
    ).padStart(2, "0")}`;

    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      timerElement.textContent = "TIME'S UP!";
      timerElement.style.color = "red";
      timerElement.style.textShadow = "0 0 15px red";
      alert("Time's up! Submitting your answers...");
      submitFlags(); // Automatically submit when time runs out
    } else {
      timeLeft--;
    }
  }

  const timerInterval = setInterval(updateTimer, 1000);
  updateTimer()

  function submitFlags() {
    const inputs = document.querySelectorAll("input, select");
    const submissions = {
      user: userData?.username,
      timestamp: new Date().toISOString(),
      flags: [],
    };

    inputs.forEach((input, index) => {
      submissions.flags.push({
        challenge: `Challenge ${index + 1}`,
        answer: input.value,
      });
    });

    // Save to localStorage
    const existingData = JSON.parse(localStorage.getItem("submissions")) || [];
    existingData.push(submissions);
    localStorage.setItem("submissions", JSON.stringify(existingData));

    alert("Submission Received!");
  }
</script>
